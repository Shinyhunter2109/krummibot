const tmi=require("tmi.js"),pokemon=require("pokemon"),fs=require("fs"),path="./users.json";var users={};try{if(fs.existsSync(path)){let userfile=fs.readFileSync(path);users=JSON.parse(userfile)}}catch(err){console.error(err)}require("dotenv").config();const opts={options:{debug:!0,messagesLogLevel:"info"},connection:{reconnect:!0,secure:!0},identity:{username:process.env.BOT_NAME,password:process.env.BOT_OAUTH},channels:["mrkrummschnabel"]},bot=new tmi.client(opts);function raidHandler(channel,raider,viewers){bot.say(channel,`${raider}, raidet mit ${viewers} Flamingos`),bot.say(channel,`!so ${raider}`)}function messageHandler(channel,userstate,message,self){self||(userstate["user-id"]in users?users[userstate["user-id"]].login=userstate.username:(console.log("user not exist"),users[userstate["user-id"]]={login:userstate.username,pokemon:{list:[],catchable:!1,current:"",tries:"",actualpoints:"",pointstocatch:"",runningRound:!1}}),commandHandler(channel,message,userstate),fs.writeFileSync(path,JSON.stringify(users,null,"\t")))}function commandHandler(channel,message,userstate){const checklove=message.split(" "),command=message;if("#mrkrummschnabel"===channel){if("!joinchannel"===command&&bot.join(userstate.username).then(data=>{console.log(data)}).catch(err=>{console.log(err)}),"mrkrummschnabel"===userstate.username&&"!shutdown"===command&&(bot.part(channel).then(data=>{console.log(data)}).catch(err=>{console.error(err)}),process.exit(0)),"mrkrummschnabel"===userstate.username&&("!test"===command&&bot.say(channel,"!test"),command.startsWith("!so"))){let so=command.split(" ");so.length>1&&bot.say(channel,`Schaut mal bei @${so[1]} vorbei und verschenkt Liebe. https://twitch.tv/${so[1]}`)}if(userstate.mod&&command.startsWith("!so")){let so=command.split(" ");so.length>1&&bot.say(channel,`Schaut mal bei @${so[1]} vorbei und verschenkt Liebe. https://twitch.tv/${so[1]}`)}"pentiboy"===userstate.username&&command.includes("wie geht es dir")&&bot.say(channel,`@${userstate.username} ${pentiboy()}`),"!website"===command&&bot.say(channel,"Schaut mal auf meiner Website oder meinem Shop vorbei. Website: krummschnabel.de / Shop: shop.krummschnabel.de"),"!lurk"===command&&bot.say(channel,"mrkrummschnabel ist jetzt im Lurk, er / sie benötigt noch ein paar Äste für seinen / ihren Nistplatz. Sie / Er lässt aber Fische für dich hier <3"),"!krummi"===command&&bot.say(channel,"ich kann genauso wenig wie mein Ersteller... nicht wahr @MrKrummschnabel!\r\nVersuch mal !command"),"!command"===command&&bot.say(channel,"Folgende Kommandos funktionieren: !krummi, !miesmuschel <Frage>, !command, !love <Username>, !würfel, !coin, !games"),"!miesmuschel"===command.slice(0,message.indexOf(" "))&&bot.say(channel,`@${userstate.username} ${selectRandomQuote()}`),"!würfel"===command&&rollDice(channel),"!love"===command.slice(0,message.indexOf(" "))&&makelove(userstate,channel,checklove),"!coin"===command&&throwCoin(channel),userstate["user-id"]===userstate["room-id"]&&"!leavechannel"===command&&bot.part(channel).then(data=>{console.log(data)}).catch(err=>{console.error(err)}),"!games"===command&&bot.say(channel,"Folgende Spiele stehen zur Verfügung: Pokemon. Um mehr zu erfahren verwende !pokemon help")}"!pokemon"===command&&startpokemongame(channel,userstate),"!catch"===command&&catchpokemon(channel,userstate),"!index"===command&&pokeindex(channel,userstate),"!pokemon help"===command&&bot.say(channel,"Mit !pokemon startest du eine Runde. Verwende !catch um das Pokemon zu fangen Das Pokemon muss zuerst gefangen werden oder verschwinden bevor du eine neue Runde starten kannst Mit !index siehst du wie viele und welche Pokemons du bereits gefangen hast")}function startpokemongame(channel,userstate){let randomPook=pokemon.random("de");return 0==users[userstate["user-id"]].pokemon.runningRound?(bot.say(channel,`Einwildes ${randomPook} erscheint`),users[userstate["user-id"]].pokemon.actualpoints="",users[userstate["user-id"]].pokemon.current=randomPook,users[userstate["user-id"]].pokemon.catchable=!0,users[userstate["user-id"]].pokemon.tries=Math.floor(5*Math.random()),users[userstate["user-id"]].pokemon.pointstocatch=Math.floor(100*Math.random()),users[userstate["user-id"]].pokemon.runningRound=!0):bot.say(channel,"Du befindest dich schon in einer Runde"),randomPook}function catchpokemon(channel,userstate){users[userstate["user-id"]].pokemon.catchable?0!=users[userstate["user-id"]].pokemon.tries?(users[userstate["user-id"]].pokemon.actualpoints=Math.floor(50*Math.random()),(users[userstate["user-id"]].pokemon.actualpoints==users[userstate["user-id"]].pokemon.pointstocatch||users[userstate["user-id"]].pokemon.actualpoints>users[userstate["user-id"]].pokemon.pointstocatch)&&(bot.say(channel,`Glückstrumpf du hast ${users[userstate["user-id"]].pokemon.current} gefangen.`),users[userstate["user-id"]].pokemon.list.push(users[userstate["user-id"]].pokemon.current),users[userstate["user-id"]].pokemon.actualpoints="",users[userstate["user-id"]].pokemon.pointstocatch="",users[userstate["user-id"]].pokemon.catchable=!1,users[userstate["user-id"]].pokemon.runningRound=!1,users[userstate["user-id"]].pokemon.tries=""),users[userstate["user-id"]].pokemon.tries--,0==users[userstate["user-id"]].pokemon.tries&&(users[userstate["user-id"]].pokemon.tries="",users[userstate["user-id"]].pokemon.actualpoints="",users[userstate["user-id"]].pokemon.pointstocatch="",users[userstate["user-id"]].pokemon.catchable=!1,users[userstate["user-id"]].pokemon.runningRound=!1,bot.say(channel,`@${userstate.username}, ${users[userstate["user-id"]].pokemon.current} ist verschwunden`))):(users[userstate["user-id"]].pokemon.tries="",users[userstate["user-id"]].pokemon.actualpoints="",users[userstate["user-id"]].pokemon.pointstocatch="",users[userstate["user-id"]].pokemon.catchable=!1,users[userstate["user-id"]].pokemon.runningRound=!1,bot.say(channel,`@${userstate.username}, ${users[userstate["user-id"]].pokemon.current} ist verschwunden`)):0!=users[userstate["user-id"]].pokemon.tries&&""!=users[userstate["user-id"]].pokemon.tries||bot.say(channel,`@${userstate.username} Du musst erst eine neue runde Starten`)}function pokeindex(channel,userstate){let pokedex=pokemon.all("de"),counter=0,actualpok=[];for(t in pokedex)users[userstate["user-id"]].pokemon.list.includes(pokedex[t])&&(counter++,actualpok.push(pokedex[t]));bot.say(channel,`@${userstate.username}Du hast ${counter+" Pokemons und zwar "+actualpok} `)}function throwCoin(channel){const sides=2,kante=1,fall=Math.floor(2*Math.random()+1*Math.random()/Math.PI);0==fall&&bot.say(channel,"Du hast Kopf geworfen"),1==fall&&bot.say(channel,"Du hast Zahl geworfen"),2==fall&&bot.say(channel,"Du hast die Kante im Gras versenkt")}function makelove(userstate,channel,checklove){let usersplit=userstate["user-id"].split(""),userA=0,userB=0;for(const iterator of usersplit)userA+=iterator.charCodeAt(0);usersplit=checklove.slice(checklove.indexOf(" ")).toString().replace("@","");for(const iterator of usersplit)userB+=iterator.charCodeAt(0);let min=Math.min(userA,userB),max=Math.max(userA,userB),matching=Math.round(min/max*100);bot.say(channel,`${userstate.username} du und @${usersplit} passen zu ${matching}% zusammen`)}function rollDice(channel){const sides=6;bot.say(channel,`Du hast eine ${Math.floor(6*Math.random())+1} gewürfelt`)}function selectRandomQuote(){let quote_yes=["Ja","Ja definitiv","Positiv","Hättest du etwas anderes erwartet?","Nur mit guter bezahlung"],quote_no=["Nein","Weils du bist NEIN","Nö","Kener hat die Absicht hier Ja zu sagen.","Gegenfrage würdest du nackt und mit Fleisch behängt vor einem hungrigen Tiger tanzen?","Deswegen wird er auch nicht größer also nein!","Ich musste dich jetzt einfach darauf Hinweisen. Du bist so hüpsch wie ein Badewannenstöpsel deswegen muss ich deine Anfrage leider ablehnen.","Nein du stinkst geh dich erstmal waschen!","Sprich mit meiner Hand.","Ihre Bestellung wurde erfolgreich aufgenommen es werden 2502,35€ von ihrem Konto abgebucht. Danke","Nein ich bin tot. Leg den Kranz hin und lass mich in Frieden ruhen","Nein, das ist flüssiger Sonnenschein.","Nein, ich lüge","Nein. Ich bin gerade damit beschäftigt Menschen zu beobachten wie sie sich zum Affen machen.","Diese Sache finde ich genauso positiv wie Durchfall!","NEIN und wenn du nochmal so dämliches zeug frägst werfe ich dich ins Feuer und opfere dich der Göttin Brutzla"],a,randomNumber;switch(Math.floor(2*Math.random())){case 0:return randomNumber=Math.floor(Math.random()*quote_yes.length),`${quote_yes[randomNumber]}`;case 1:return randomNumber=Math.floor(Math.random()*quote_no.length),`${quote_no[randomNumber]}`;default:return"something went wrong"}}function pentiboy(){let quote=["Die geht es Scheiße","Weil du es bist sei still","Nö, frag einfach nicht","Kener hat die Absicht hier was gutes zu sagen.","Gegenfrage würdest du nackt und mit Fleisch behängt vor einem hungrigen Tiger tanzen?","du stinkst geh dich erstmal waschen!","Sprich mit meiner Hand."],randomNumber;return randomNumber=Math.floor(Math.random()*quote.length),`${quote[randomNumber]}`}bot.connect().then(console.log).catch(console.error),bot.on("message",messageHandler),bot.on("raided",raidHandler);